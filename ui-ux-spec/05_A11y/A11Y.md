# 可访问性规格（A11y，按现状复刻）

> 本文件描述当前 UI 的键盘行为与可访问性语义。目标是“如实复刻”，不是“整改到 WCAG”。  
> 如需整改，请另开任务（否则会改变可观察行为/DOM）。

事实源：`html/src/components/terminal/xterm/index.ts`、`html/src/components/modal/index.tsx`、`html/src/components/modal/modal.scss`、xterm.js 依赖行为。

---

## 1) 焦点与键盘（Focus & Keyboard）

### 1.1 终端焦点

- WS open 后：调用 `terminal.focus()`，终端获得焦点（事实源：`onSocketOpen()`）。
- 复制/选择文本不会改变焦点（但 selection change 会触发 copy 行为）。

### 1.2 Enter 触发重连

当连接关闭且进入“等待用户确认重连”模式时：
- 监听 `terminal.onKey`，当 `event.key === 'Enter'` 触发重连。
- 这意味着重连确认依赖终端本身仍能捕获键盘事件（即 xterm 仍在 DOM 中且可接收键盘）。

### 1.3 beforeunload 提示

- 当 WS OPEN 且用户试图关闭页面：触发浏览器原生 beforeunload 提示（文案固定，见 patterns）。
- 若 `disableLeaveAlert=true`：移除 beforeunload listener。

---

## 2) Modal（文件选择弹窗）的可访问性语义

事实源：`Modal` 组件输出 DOM 仅包含 div 结构，无 aria。

### 2.1 语义现状（必须复刻）

- Modal 根节点：`<div class="modal">`（无 `role="dialog"`，无 `aria-modal`）
- 无焦点陷阱（focus trap）
- 无 ESC 关闭
- 无点击遮罩关闭
- Modal 打开时不会自动把焦点移到文件按钮/输入框

### 2.2 文件输入

- `<input type="file" multiple class="file-input">` 被 CSS 隐藏到 `.01em` 尺寸并绝对定位
- 可点击的是 `<span class="file-cta">Choose files…</span>`（位于 `<label>` 内，因此点击文字会触发 input）

---

## 3) Overlay（提示层）的可访问性语义

Overlay 是一个动态插入的 `<div>`：
- 无 ARIA role（不是 `status`/`alert`）
- 文案变化不会被屏幕阅读器作为 live region 宣读
- `mousedown` 被阻止默认与冒泡（避免影响终端）

---

## 4) 建议（非强制，若整改会改变行为）

以下建议不属于“现状复刻”，仅供未来优化：
- Modal 增加 `role="dialog"`、`aria-modal="true"`，并实现 focus trap 与 ESC 关闭；
- Overlay 使用 `aria-live="polite"` 或 `role="status"`；
- 为文件按钮添加可聚焦元素与键盘操作提示。

